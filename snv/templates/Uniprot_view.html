{% extends "base.html" %}
{% block pagetitle %}Uniprot ID: {{uniprot.acc_number}} {% endblock %}
{% block css%}
p.wrap
{
word-wrap:break-word;
}
input[type=radio] {
    display:none;
}
input[type=radio]:checked + label {
   background-image: none;
    background-color:#e7e7e7;
}
.box{
        display: none;
}

h1{ position:relative; }
h1 span{ position:absolute; top:-70px;}
h3{ position:relative; }
h3 span{ position:absolute; top:-70px;}
{% endblock %}
{% load staticfiles %}
{% block javascript %}<link href="{{ STATIC_URL }}offcanvas.css" rel="stylesheet">
<!-- <script src="{{ STATIC_URL }}tooltip.js"></script> -->
{% endblock %}

{% block content %}

<!-- ################## Uniprot BASIC VIEW ##################################-->
<div class="row row-offcanvas row-offcanvas-right"> 
	<div class="col-xs-12 col-sm-9"><!-- Left Canvas-->

		<div class="row">
			<div class="col-md-4">
				<img src="{{ STATIC_URL }}protein_previews_thumbnails/{{uniprot.acc_number}}.jpeg" alt="{{uniprot.acc_number}}" class="img-thumbnail">
				<button class="btn btn-default" data-toggle="modal" data-target="#myModalimg">
				 	View Large Image &raquo; 
				</button>
			</div>

			
			<!-- Modal -->
			<div class="modal fade" id="myModalimg" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog">
				<div class="modal-content">
				  <div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>      
					<h4 class="modal-title" id="myModalLabel">ID: {{uniprot.acc_number}}</h4>
				  </div>
				  <div class="modal-body" >
					<img src="{{ STATIC_URL }}protein_previews/{{uniprot.acc_number}}.png" class="img-responsive" alt="Responsive image">
				  </div>
				  <div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  </div>
				</div>
			  </div>
			</div>



			<div class="col-md-8">
				<h3><span id = "basic"></span>Uniprot ID: {{uniprot.acc_number}} </h3>
				<strong>Summary</strong>
				<p>{{ uniprot.get_seq | length}} amino acids</p>
				<p>{{uniprot.chains.all | length}} chains </p>
				<p>{{interactions | length}} interactions </p>

				<p>{{snv_list|length}} SNVs </p>
				{% if snv_list %}
				<p>{{snv_statistic.1}}% Diseases, {{snv_statistic.2}}% Polymorphisms, {{snv_statistic.3}}% Unclassified</p>{% endif %}
			</div>
		  
		</div>




		<h3>Sequence</h3>
		<div class = "well">   
   			<p class="wrap" style ="word-wrap:break-word; font-family: 'Source Code Pro', sans-serif; ">{{ uniprot.get_seq }}</p>
				<!-- Button trigger modal -->
				<button class="btn btn-primary" data-toggle="modal" data-target="#myModal">
				  Get raw sequence 
				</button>
			<!-- Modal -->
			<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			  <div class="modal-dialog">
				<div class="modal-content">
				  <div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>      
					<h4 class="modal-title" id="myModalLabel">ID: {{uniprot.acc_number}}</h4>
				  </div>
				  <div class="modal-body" style ="word-wrap:break-word;" >
					<input type="button" class="btn btn-primary btn-lg" value = "FASTA" onclick="window.open('http://www.uniprot.org/uniprot/{{uniprot.acc_number}}.fasta','_blank','resizable=yes')" />
				  </div>
				  <div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
				  </div>
				</div>
			  </div>
			</div>
		</div><!-- End Well -->


<!-- #######################################    CHAINS   ############################################################################-->	
		<h3><span id = "chains"></span>Found {{uniprot.chains.all | length}} chain entries for the protein {{uniprot.acc_number}}:</h3>
			{% if uniprot.chains.all %}
				<table class="table table-condensed">
					<tr>
						<td><strong>PDB id</strong></td>
						<td><strong>PDB chain</strong></td>
						<td><strong>PDB model</strong></td>
						<td><strong>Sequence identity (%)</strong></td>
						<td><strong>Coverage (%)</strong></td>
						<td><strong>Sequence start</strong></td>
						<td><strong>Sequence end</strong></td>
					</tr>
				{% for item in chains %}
					<tr>
						<td><a data-toggle="popover" data-content="External link to PDB" target="_blank" href = "http://www.rcsb.org/pdb/explore/explore.do?structureId={{item.obj.pdb_id}}">{{item.obj.pdb_id}}</a></td>
						<td>{{item.obj.pdb_chain}}</td>
						<td>{{item.obj.pdb_model}}</td>
						<td>{{item.obj.seq_identity}}</td>
						<td>{{item.obj.coverage}}</td>
						<td>{{item.obj.seq_start}}</td>
						<td>{{item.obj.seq_end}}</td>
					</tr>
					<tr>
						<td colspan="7">{{item.graphic|safe}}<br>

						<div class="panel-group" id="accordion">
						  <div class="panel panel-default">
							<div class="panel-heading">
							  <h4 class="panel-title">
								<a data-toggle="collapse" data-parent="#accordion" href="#collapse{{item.obj.id}}">
								  Show/Hide Alignment
								</a>
							  </h4>
							</div>
							<div id="collapse{{item.obj.id}}" class="panel-collapse collapse">
							  <div class="panel-body" style ="word-wrap:break-word; font-family: 'Source Code Pro', sans-serif; ">
								{{item.alignent|safe}}
							  </div>
							</div>
						  </div>
						</div>				
						</td>
					</tr>

				{% endfor %}
				</table>
			{% else %}
				<p>The protein has no registered chain entries</p>
			{% endif %}

<!-- #######################################    INTERACTION   ############################################################################-->
		<h3><span id = "interactions"></span>Found {{interactions | length}} interaction entries for the protein {{uniprot.acc_number}}:</h3>

	
		{% if interactions %}
			<!-- POP UP JAVA SCRIPT--> 
			<script>
				function myFunction(url)
				{
					cuteLittleWindow = window.open(url, "_blank", "location=no,width=600,height=850");
				}
			</script> 

			<!-- END OF POP UP JAVA SCRIPT-->
			<table class="table table-condensed table-hover">
			<thead>
				<tr>
					<th>ID</th>
					<th>Partner 1</th>
					<th>Partner 2</th>
					<th>Type</th>
					<th>View Interaction</th>
				</tr>
			</thead>
			<tbody>
				{% for item in interactions %}
					<tr>
						<td>{{item.obj.id}}</td>
						<td><a href="{% url 'uniprot-view' pk=item.obj.chain_1.uniprot.acc_number %}">{{item.obj.chain_1.uniprot.acc_number}}</a></td>
						<td><a href="{% url 'uniprot-view' pk=item.obj.chain_2.uniprot.acc_number %}">{{item.obj.chain_2.uniprot.acc_number}}</a></td>
						<td>{{item.obj.inter_type.inter_type}}</td>
						<td><button class="btn btn-primary btn-sm" onclick="myFunction('{% url 'interaction-view' pk=item.obj.id %}')">View 3D Interaction</button> <input type="button" class="btn btn-success btn-sm" value = "Download PDB" onclick="window.open('{{BASE_URL}}{% static item.obj.filename %}')" /></td>
					</tr>
					<tr>
						<td colspan="5">
							<p>{{item.code.0|safe}}</p>
							<p>{{item.code.1|safe}}</p>
						</td>
					</tr>

				{% endfor %}
			</tbody>			
			</table>
		{% else %}
			<p>The protein has no associated interaction entries</p>
		{% endif %}

<!-- #######################################    SNV & Interaction MAPING   ############################################################################-->
		<h3><span id = "map"></span>Mapping SNV and Interaction to the sequence</h3>

			<div class="alert alert-info">
				<ul><li>Select marking options from a menu to mark the interaction regions.</li><li>Hover and click on each SNV position to see more detail. </li></ul>
			</div>

			<!-- JAVASCRIPT -->
			{{markscript|safe}}
			<!-- END JAVASCRIPT -->

			<div class="btn-group">
				{% for option in marked_reg %}
				<input type="radio" name="options" id="{{option.id}}" {{option.checked}}><label class="btn btn-default btn-xs" for="{{option.id}}" data-toggle="popover" data-content="Show interection site for {{option.info}}" >{{option.name}}</label>
				{% endfor %}
			</div>


			{% for option in marked_reg %}
			<div class="box {{option.id}}">
				<p>{{option.graphic_code|safe}}</svg></p>
				<script type="text/javascript">
					{{option.java_code|safe}}
				</script>				
				<div class = "well">				
					<p>You have selected <strong>{{option.info}}</strong></p><p  style ="word-wrap:break-word; font-family: 'Source Code Pro', sans-serif; ">{{option.sequence|safe}}</p>
				</div>				
			</div>

			{% endfor %}



			{% if snv_list %}
			<strong><p>Colour code:</p></strong>
			<p><code style="background-color:red;color:white;">A</code> Disease, <code style="background-color:green;color:white;">A</code> Polymorphism, <code style="background-color:blue;color:white;">A</code> Unclassified, <code style="background-color:purple;color:white;">A</code> Multiple variations </p>     
			{% endif %}

		<!-- MODAL TO DISPLAY WHEN CLICKING ON MUTIPLE MUTATION POSSITION-->
		<div style="display: none;" id="addBookDialog" class="modal fade bs-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">
			<div class="modal-dialog modal-sm">
			  <div class="modal-content">

				<div class="modal-header">
				  <button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>
				  <h4 class="modal-title" id="mySmallModalLabel">Select the SNV you would like to see</h4>
				</div>
				<div class="modal-body">
					<div id="myResults"></div>
				</div>
			  </div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->


<!-- #######################################    SNV DATA  ############################################################################-->
		<h3><span id = "snvs"></span>Found {{snv_list|length}} SNVs for the protein {{uniprot.acc_number}}:</h3>
		{% if snv_list %}
		<p>SNVs statistics</p>

		<div class="progress">
		  <div class="progress-bar progress-bar-danger" role="progressbar" style="width: {{snv_statistic.1}}%" data-toggle="popover" data-content="Diseases">
			{{snv_statistic.1}}% Diseases
		  </div>

		  <div class="progress-bar progress-bar-success" role="progressbar"  style="width: {{snv_statistic.2}}%" data-toggle="popover" data-content="Polymorphisms">
			{{snv_statistic.2}}% Polymorphisms
		  </div>

		  <div class="progress-bar progress-bar-info" role="progressbar" style="width: {{snv_statistic.3}}%" data-toggle="popover" data-content="Unclassified">
			{{snv_statistic.3}}% Unclassified
		  </div>
		</div>





		<table class="table table-condensed table-hover">
			<thead>
				<tr>
					<th>FT id</th>
					<th>Type</th>
					<th>Pos</th>
					<th>Mutation</th>
					<th>dbSNP id</th>
					<th>Directly associated disorder</th>
					<th>OMIM code</th>
				</tr>
			</thead>	
			<tbody>		
				{% for item in snv_list %}
				<tr>
					<td><a href="{% url 'snv-view' pk=item.ft_id %}" target='_blank'>{{item.ft_id}}</a></td>
					<td><code style="background-color:{% if item.type.type == 'Disease' %}red{% elif item.type.type == 'Polymorphism'%} green {% else %} blue {% endif %}; color:white;">{{item.type.type}} {{item.get_color.all}}</code></td>
					<td>{{item.uniprot_residue.position}}</td>
					<td>{{item.wt_aa.one_letter_code}} <span class="glyphicon glyphicon-arrow-right"></span> {{item.mutant_aa.one_letter_code}}</td>
					{% if item.db_snp %}
					<td><a data-toggle="popover" data-content="External link to dbSNP"  href="http://www.ncbi.nlm.nih.gov/SNP/snp_ref.cgi?searchType=adhoc_search&type=rs&rs={{item.db_snp}}" target='_blank'>{{item.db_snp}}</a></td>
					{% else %}
					<td>No Data</td>
					{% endif %}
					{% if item.diseases.all %}
					<td>
						<table>
						{% for element in item.diseases.all %}
							<tr><td><a href="{% url 'disease-view' pk=element.mim %}" target='_blank'>{{element.name}}</a></td></tr>
						{% endfor %}
						</table>
					</td>
					<td>
						<table>
						{% for element in item.diseases.all %}
							<tr><td><a data-toggle="popover" data-content="External link to OMIM"  href="http://omim.org/entry/{{element.mim}}" target='_blank'>{{element.mim}}</a></td></tr>
							{% endfor %}
						</table>
					</td>
					{% else %}
					<td>N/A</td>
					<td>N/A</td>
					{% endif %}
				</tr>
				{% endfor %}
			</tbody>	
		</table>
		{% else %}
		<p>The protein has no associated SNV entries</p>
		{% endif %}
	</div><!--/ Left Canvas COL span-->


<!-- ################## NAVIGATION BAR ##################################-->
	<div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
		<div class="span3 bs-docs-sidebar">
			<ul class="nav nav-list bs-sidenav affix">
				<li><strong><span class="glyphicon glyphicon-search"></span> Quick Navigation</strong></li>
				<li><a href="#basic"><span class="glyphicon glyphicon-chevron-right"></span> Basic information</a></li>
				<li><a href="#chains"><span class="glyphicon glyphicon-chevron-right"></span> Chains</a></li>
				<li><a href="#interactions"><span class="glyphicon glyphicon-chevron-right"></span> Interactions</a></li>
				<li><a href="#map"><span class="glyphicon glyphicon-chevron-right"></span> SNVs & Interaction Mapping</a></li>
				<li><a href="#snvs"><span class="glyphicon glyphicon-chevron-right"></span> Related SNVs</a></li>
			</ul>
		</div><!--/span-->
	</div><!--/col-->
</div><!--/row-->

{% endblock %}

{% block extraplugin %}
<script type="text/javascript">
	$('[data-toggle="tooltip"]').tooltip({
		'placement': 'top'
	});
	$('[data-toggle="popover"]').popover({
		trigger: 'hover',
		    'placement': 'top'
	});

	/*$('[data-toggle="modal"]').popover({
		trigger: 'hover',
		    'placement': 'top'
	});
	*/
	$('#userNameField').tooltip({
		'show': true,
		    'placement': 'bottom',
		    'title': "Please remember to..."
	});

	$('#userNameField').tooltip('show');


	$(document).on("click", ".open-AddBookDialog", function () {
		 var myBookId = $(this).data('id');
		// 'Modern' browsers (IE8+, use CSS-style selectors)
		document.querySelector('#myResults').innerHTML = myBookId;
		// Using the jQuery library
		$('#myResults').html(myBookId);
		// Legacy browser support
		document.getElementById('myResults').innerHTML = myBookId;
		 //$(".modal-body #bookId").val( myBookId );
	});
</script>
{% endblock %}
